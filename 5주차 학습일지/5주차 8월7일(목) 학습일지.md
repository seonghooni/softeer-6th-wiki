# 1. 리뷰
## :laughing: 오늘 한 작업
### 1. 팀 프로젝트 진행

#### 2차 배포, 그리고 CI/CD 과정에서의 오류

내일 데모데이를 앞두고, 오늘 2차 배포를 진행했다. 

이번 배포를 위해 develop 브랜치의 모든 변경사항을 main 브랜치에 병합하면서, 예상대로 매우 많은 충돌(conflict) 이 발생했다.

사실 1차 배포 이후에도 우리 팀은 ERD를 지속적으로 수정했고, 클래스명과 필드명도 더 직관적으로 이해할 수 있도록 개선하는 작업을 반복해왔다.   
이 과정은 코드의 가독성과 품질을 높이기 위한 과정이었지만, 그만큼 브랜치 간 충돌이 잦아질 수밖에 없었다.

충돌을 전부 해결하고 나니, 이제는 배포 과정에서 문제가 발생헀다.

배포 환경에서 "DB URL이 잘못되었다"는 오류 로그가 출력되며 정상적으로 실행이 되지 않는 것이었다.

문제 원인을 파악하기 위해 각 단계별로 어떻게 동작하는지 면밀히 따져봐야 했다.

확인했던 원인은 다음과 같았다.

**배포 환경에서 jar 파일을 직접 열어 application.yml 파일을 보니, 다음과 같이, 설정 값이 그대로 남아있었다.**

```yml
spring:
  datasource:
    url: ${DB_URL}
```

나는 분명 Github workflow에서 아래 처럼 환경변수를 깃허브 시크릿 값으로부터 불러와 빌드하는 동작을 정의해두었다.

``` yml
# CI/CD workflow.yml
env:
  SPRING_PROFILE: prod
  DB_URL: ${{ secrets.DB_URL }}
```


이게 왜 정상적으로 동작하지 않는지 확인해보니, 

GitHub Actions에서 Jar 파일을 빌드하고, 이를 EC2에 전달해주더라도 GitHub의 환경 변수는 EC2에는 아무런 영향을 주지 않는다.  
둘은 완전히 독립된 실행 환경인 것이다.

**이제서야 문제 원인을 알고 돌이켜 생각해보면**, '우리가 `java -jar` 명령어를 실행할 때 환경변수를 지정하는 것처럼,  
"빌드 환경과 실행 환경은 명확하게 분리되어 있다"는 사실을 간과하고 헤맸던 것이 이제 생각하면 너무 아쉬웠다.

**너무 단순하고 당연한 개념인데, 그 지점을 놓쳐, 문제를 해결하는 데 오랜 시간을 보낸 것을 반성한다..**

<br>

## :dizzy: 작업 과정에서의 배운 것

### 🔹 병합 주기는 짧게 가져가야 한다.

긴 시간 develop 브랜치를 main과 따로 두면 충돌 규모는 커질 수밖에 없다. 

특히 이번처럼 주요 변경이 있을 때마다 주기적으로 병합하거나, 자주 rebase하는 습관이 중요하다.

**그렇지 않으면, 한 번에 너무 많은 conflict를 해결하며 더 많은 오류를 마주하는 conflict의 늪에 빠진다...**

<br>

### 🔹 Github는 파일 경로(패키지 경로)가 달라지면 서로 다른 파일로 인식할 수 있다.

예를 들어, 같은 파일명을 가진 클래스라도 다음과 같은 변경이 있을 경우, 서로 다른 파일로 인식하고 + 충돌 없이 병합해버릴 수 있다.

`com.todoc.domain.lastlocation.LatestLocation` → `com.todoc.domain.lastestlocation.LatestLocation`

아무런 경고 없이 병합될 수 있다는 것이다.

**앞으로 패키지명에 변경이 있을 경우 merge 작업에서 주의를 기울여야겠다는 생각을 했다.**

하지만 이런 생각도 들었다.

이 동작 방식은, "여러 명이 동시에 같은 클래스를 수정해야 할 때, 서로 패키지를 나누어 작업하면 충돌 없이 병합할 수 있다"라는 장점도 있는 것 같다.



<br>

## :sob: 어려웠던 점

### 🔹 오늘 목표로 한 작업이 있었는데...

예상치 못하게 CI/CD에서 아주 사소한 개념을 놓친 것 때문에, 굉장히 많은 시간을 소모하게 되었다.

단순한 개념 하나를 제대로 이해하지 못한 것이 꼬리에 꼬리를 물고,

배포와 디버깅을 계속해서 반복하게 만들었다.

이런 걸 "스노우볼링" 이라고 표현하는 것 같다.

작은 실수 하나가, 눈덩이처럼 커져버린 경험이었다.

<br><br>

# 2. 회고 (KPT)

✅ **K – Keep (유지할 것)**
- 팀원의 문제상황과 진행상황에 지속적으로 관심 가지고, 나 역시 자주 공유하기

🛠️ **P – Problem (개선이 필요한 점)**
- main 브랜치로의 병합 주기를 좀 더 짧게 가져가자. 나중에 한번에 충돌 해결에서 고생한다.

🔄 **T – Try (시도할 것)**
- 프론트엔드 분들과 주간 회고로 점검하고, 진행 상황을 상세하게 공유하고 이번주 목표 달성하는 데 집중하기


<br><br>
